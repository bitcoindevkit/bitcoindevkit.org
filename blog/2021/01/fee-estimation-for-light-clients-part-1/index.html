<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Fee estimation for light-clients (Part 1) | Bitcoin Dev Kit Documentation</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="preload" href="/fonts/ibm-plex-mono-400.woff2" as="font" crossorigin="true">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="stylesheet" href="/css/variables.css">
    <link name="msapplication-config" content="/browserconfig.xml">
    <link name="msapplication-TileColor" content="#ffffff">
    <link name="theme-color" content="#ffffff">
    <meta name="description" content="Applying machine learning to the bitcoin fee estimation problem">
    <meta property="article:published_time" content="2021-01-25T00:00:00.000Z">
    <meta property="og:site_name" content="Bitcoin Dev Kit Documentation">
    <meta property="og:title" content="Fee estimation for light-clients (Part 1)">
    <meta property="og:description" content="Applying machine learning to the bitcoin fee estimation problem">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://bitcoindevkit.org/blog/2021/01/fee-estimation-for-light-clients-part-1/">
    <meta property="og:image" content="https://bitcoindevkit.org/card.png">
    <meta name="twitter:title" content="Fee estimation for light-clients (Part 1)">
    <meta name="twitter:description" content="Applying machine learning to the bitcoin fee estimation problem">
    <meta name="twitter:url" content="https://bitcoindevkit.org/blog/2021/01/fee-estimation-for-light-clients-part-1/">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="https://bitcoindevkit.org/card.png">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="fee, machine learning">
    <meta property="article:tag" content="fee">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    
    <link rel="preload" href="/assets/css/0.styles.d0e837cb.css" as="style"><link rel="preload" href="/assets/js/app.b7fe13ec.js" as="script"><link rel="preload" href="/assets/js/4.421e1146.js" as="script"><link rel="preload" href="/assets/js/1.519cc26e.js" as="script"><link rel="preload" href="/assets/js/59.9b9541ac.js" as="script"><link rel="prefetch" href="/assets/js/10.13eb2570.js"><link rel="prefetch" href="/assets/js/11.1a9d756a.js"><link rel="prefetch" href="/assets/js/12.099952e0.js"><link rel="prefetch" href="/assets/js/16.3dfe9d52.js"><link rel="prefetch" href="/assets/js/17.0755a2b9.js"><link rel="prefetch" href="/assets/js/18.19b51f0b.js"><link rel="prefetch" href="/assets/js/19.13924d29.js"><link rel="prefetch" href="/assets/js/2.9f0b68aa.js"><link rel="prefetch" href="/assets/js/20.2e10f8ab.js"><link rel="prefetch" href="/assets/js/21.87c145fc.js"><link rel="prefetch" href="/assets/js/22.254320de.js"><link rel="prefetch" href="/assets/js/23.6ffea0dd.js"><link rel="prefetch" href="/assets/js/24.1e20990d.js"><link rel="prefetch" href="/assets/js/25.029e16c5.js"><link rel="prefetch" href="/assets/js/26.d6bc6d26.js"><link rel="prefetch" href="/assets/js/27.4781c958.js"><link rel="prefetch" href="/assets/js/28.a211e143.js"><link rel="prefetch" href="/assets/js/29.094122b5.js"><link rel="prefetch" href="/assets/js/3.55a6475d.js"><link rel="prefetch" href="/assets/js/30.cc2bbcfa.js"><link rel="prefetch" href="/assets/js/31.f9273387.js"><link rel="prefetch" href="/assets/js/32.4501c742.js"><link rel="prefetch" href="/assets/js/33.ebb81ce2.js"><link rel="prefetch" href="/assets/js/34.842dbe3a.js"><link rel="prefetch" href="/assets/js/35.df559a7a.js"><link rel="prefetch" href="/assets/js/36.3e431550.js"><link rel="prefetch" href="/assets/js/37.87c3a0a8.js"><link rel="prefetch" href="/assets/js/38.8fd5c156.js"><link rel="prefetch" href="/assets/js/39.f8b5da6d.js"><link rel="prefetch" href="/assets/js/40.5f4c9ecf.js"><link rel="prefetch" href="/assets/js/41.017da959.js"><link rel="prefetch" href="/assets/js/42.c35335fc.js"><link rel="prefetch" href="/assets/js/43.ee88bf0c.js"><link rel="prefetch" href="/assets/js/44.8ea1104a.js"><link rel="prefetch" href="/assets/js/45.8ba1d261.js"><link rel="prefetch" href="/assets/js/46.8a620891.js"><link rel="prefetch" href="/assets/js/47.1e361a05.js"><link rel="prefetch" href="/assets/js/48.6c8fd04b.js"><link rel="prefetch" href="/assets/js/49.5320af3f.js"><link rel="prefetch" href="/assets/js/5.eaa248e0.js"><link rel="prefetch" href="/assets/js/50.b7380ea9.js"><link rel="prefetch" href="/assets/js/51.d80754c0.js"><link rel="prefetch" href="/assets/js/52.912712b1.js"><link rel="prefetch" href="/assets/js/53.08f20b3c.js"><link rel="prefetch" href="/assets/js/54.018c80a1.js"><link rel="prefetch" href="/assets/js/55.06a752f4.js"><link rel="prefetch" href="/assets/js/56.4399c92b.js"><link rel="prefetch" href="/assets/js/57.d52298cb.js"><link rel="prefetch" href="/assets/js/58.b6598903.js"><link rel="prefetch" href="/assets/js/6.4b495eed.js"><link rel="prefetch" href="/assets/js/60.48c95147.js"><link rel="prefetch" href="/assets/js/61.f6ea4853.js"><link rel="prefetch" href="/assets/js/62.fa08b0a4.js"><link rel="prefetch" href="/assets/js/63.6aa4380c.js"><link rel="prefetch" href="/assets/js/64.e6ba5ed7.js"><link rel="prefetch" href="/assets/js/65.a538fc82.js"><link rel="prefetch" href="/assets/js/66.a99413d8.js"><link rel="prefetch" href="/assets/js/67.7000d297.js"><link rel="prefetch" href="/assets/js/68.f5fe4e4f.js"><link rel="prefetch" href="/assets/js/69.c92f69ce.js"><link rel="prefetch" href="/assets/js/7.f63d3c78.js"><link rel="prefetch" href="/assets/js/70.4663d7b0.js"><link rel="prefetch" href="/assets/js/71.2a8871be.js"><link rel="prefetch" href="/assets/js/72.d0343ad9.js"><link rel="prefetch" href="/assets/js/73.a5e67ee7.js"><link rel="prefetch" href="/assets/js/74.838f750f.js"><link rel="prefetch" href="/assets/js/75.4495d57e.js"><link rel="prefetch" href="/assets/js/76.8dacd584.js"><link rel="prefetch" href="/assets/js/77.04fe3c48.js"><link rel="prefetch" href="/assets/js/78.f8907212.js"><link rel="prefetch" href="/assets/js/79.0f18b068.js"><link rel="prefetch" href="/assets/js/8.ec8e08d1.js"><link rel="prefetch" href="/assets/js/80.1e8a3836.js"><link rel="prefetch" href="/assets/js/81.9b9729b4.js"><link rel="prefetch" href="/assets/js/82.409d86cb.js"><link rel="prefetch" href="/assets/js/83.4170d6d2.js"><link rel="prefetch" href="/assets/js/84.049c12f3.js"><link rel="prefetch" href="/assets/js/85.944e7baf.js"><link rel="prefetch" href="/assets/js/86.5eefdee5.js"><link rel="prefetch" href="/assets/js/87.2bbf5c66.js"><link rel="prefetch" href="/assets/js/88.c51bc3b5.js"><link rel="prefetch" href="/assets/js/89.b992622e.js"><link rel="prefetch" href="/assets/js/9.ddaf5d78.js"><link rel="prefetch" href="/assets/js/90.4a8e8e76.js"><link rel="prefetch" href="/assets/js/91.f24f14cf.js"><link rel="prefetch" href="/assets/js/92.72c473d2.js"><link rel="prefetch" href="/assets/js/93.b8e7b566.js"><link rel="prefetch" href="/assets/js/94.bff8e7bd.js"><link rel="prefetch" href="/assets/js/95.8216e261.js"><link rel="prefetch" href="/assets/js/96.1fc7dd90.js"><link rel="prefetch" href="/assets/js/97.f04434d0.js"><link rel="prefetch" href="/assets/js/98.1a6cd13c.js"><link rel="prefetch" href="/assets/js/99.946c340f.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.8b543e98.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.f8758a12.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d0e837cb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-b812d5fc data-v-92b43a16><header class="navbar" data-v-b812d5fc><div class="wrap"><div class="wrap-border"><a href="/" class="home-link router-link-active"><svg role="img" alt="Bitcoin Dev Kit Documentation" class="logo"><use href="/img/logo.svg#small" class="small"></use> <use href="/img/logo.svg#large" class="large"></use></svg></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/getting-started/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="/adoption/all.html" class="nav-link">
  Adoption
</a></div><div class="nav-item"><a href="/foundation/" class="nav-link">
  Foundation
</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  Blog
</a></div> <a href="https://github.com/bitcoindevkit/bitcoindevkit.org" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <button type="button" class="theme-switch"><svg viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg"><g class="theme-switch-dark"><path d="M15 20.4219C12.5187 20.4219 10.5 18.4032 10.5 15.9219C10.5 13.4406 12.5187 11.4219 15 11.4219C17.4813 11.4219 19.5 13.4406 19.5 15.9219C19.5 18.4032 17.4813 20.4219 15 20.4219Z" fill="currentColor"></path> <path d="M19.4541 20.3769L21.3644 22.2862M15 24.9219V22.2219V24.9219ZM15 9.62187V6.92188V9.62187ZM6 15.9219H8.7H6ZM21.3 15.9219H24H21.3ZM8.6361 22.2862L10.5454 20.3769L8.6361 22.2862ZM19.4541 11.4678L21.3644 9.55797L19.4541 11.4678ZM8.6361 9.55797L10.5454 11.4678L8.6361 9.55797Z" stroke="currentColor" stroke-width="1" stroke-linecap="round"></path></g> <g fill="currentColor" class="theme-switch-light"><path d="M10.1539 8.75585C10.018 8.75585 9.88774 8.70189 9.79168 8.60583C9.69563 8.50977 9.64166 8.37949 9.64166 8.24365V6.19482C9.64166 6.05898 9.69563 5.9287 9.79168 5.83264C9.88774 5.73658 10.018 5.68262 10.1539 5.68262C10.2897 5.68262 10.42 5.73658 10.5161 5.83264C10.6121 5.9287 10.6661 6.05898 10.6661 6.19482V8.24365C10.6661 8.37949 10.6121 8.50977 10.5161 8.60583C10.42 8.70189 10.2897 8.75585 10.1539 8.75585Z"></path> <path d="M11.1783 7.73144H9.12945C8.9936 7.73144 8.86332 7.67748 8.76726 7.58142C8.6712 7.48536 8.61724 7.35508 8.61724 7.21924C8.61724 7.08339 8.6712 6.95311 8.76726 6.85705C8.86332 6.761 8.9936 6.70703 9.12945 6.70703H11.1783C11.3141 6.70703 11.4444 6.761 11.5405 6.85705C11.6365 6.95311 11.6905 7.08339 11.6905 7.21924C11.6905 7.35508 11.6365 7.48536 11.5405 7.58142C11.4444 7.67748 11.3141 7.73144 11.1783 7.73144ZM6.05621 13.8779C5.92037 13.8779 5.79009 13.8239 5.69403 13.7279C5.59797 13.6318 5.54401 13.5015 5.54401 13.3657V12.3413C5.54401 12.2054 5.59797 12.0752 5.69403 11.9791C5.79009 11.8831 5.92037 11.8291 6.05621 11.8291C6.19206 11.8291 6.32234 11.8831 6.4184 11.9791C6.51445 12.0752 6.56842 12.2054 6.56842 12.3413V13.3657C6.56842 13.5015 6.51445 13.6318 6.4184 13.7279C6.32234 13.8239 6.19206 13.8779 6.05621 13.8779Z"></path> <path d="M6.56842 13.366H5.544C5.40816 13.366 5.27788 13.312 5.18182 13.216C5.08576 13.1199 5.0318 12.9896 5.0318 12.8538C5.0318 12.7179 5.08576 12.5877 5.18182 12.4916C5.27788 12.3955 5.40816 12.3416 5.544 12.3416H6.56842C6.70426 12.3416 6.83454 12.3955 6.9306 12.4916C7.02666 12.5877 7.08062 12.7179 7.08062 12.8538C7.08062 12.9896 7.02666 13.1199 6.9306 13.216C6.83454 13.312 6.70426 13.366 6.56842 13.366ZM16.8125 23.6101C12.8583 23.6101 9.64165 20.3934 9.64165 16.4392C9.64165 12.8983 12.2851 9.85021 15.7907 9.34876L16.4658 9.25195L16.37 9.92755C16.326 10.218 16.3027 10.5112 16.3003 10.805C16.3003 14.1942 19.0575 16.9514 22.4468 16.9514C22.708 16.9514 22.9872 16.9294 23.3247 16.8813L23.9998 16.7855L23.9035 17.4606C23.401 20.9666 20.3524 23.6101 16.8125 23.6101Z"></path></g></svg></button></div> <div class="sidebar-button"><svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="icon"><g fill="currentColor" class="hamburger"><path d="M33.75 11.6699H6.25C5.55964 11.6699 5 12.2296 5 12.9199C5 13.6103 5.55964 14.1699 6.25 14.1699H33.75C34.4404 14.1699 35 13.6103 35 12.9199C35 12.2296 34.4404 11.6699 33.75 11.6699Z"></path> <path d="M28.75 18.752H6.25C5.55964 18.752 5 19.3116 5 20.002C5 20.6923 5.55964 21.252 6.25 21.252H28.75C29.4404 21.252 30 20.6923 30 20.002C30 19.3116 29.4404 18.752 28.75 18.752Z"></path> <path d="M33.75 25.8301H6.25C5.55964 25.8301 5 26.3897 5 27.0801C5 27.7704 5.55964 28.3301 6.25 28.3301H33.75C34.4404 28.3301 35 27.7704 35 27.0801C35 26.3897 34.4404 25.8301 33.75 25.8301Z"></path></g> <g stroke="currentColor" class="close"><path d="M10 10L30 30" stroke-width="2" stroke-linecap="round"></path> <path d="M30 10L10 30" stroke-width="2" stroke-linecap="round"></path></g></svg></div></div></div></header> <div class="wrap" data-v-b812d5fc><div class="wrap-border" data-v-b812d5fc><div class="sidebar-mask" data-v-b812d5fc></div> <aside class="sidebar" data-v-b812d5fc><nav class="nav-links"><div class="nav-item"><a href="/getting-started/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="/adoption/all.html" class="nav-link">
  Adoption
</a></div><div class="nav-item"><a href="/foundation/" class="nav-link">
  Foundation
</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  Blog
</a></div> <a href="https://github.com/bitcoindevkit/bitcoindevkit.org" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Blog</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/" aria-current="page" class="sidebar-link">Articles</a></li><li><a href="/blog/tags/" class="sidebar-link">Tags</a></li><li><a href="/blog/author/" class="sidebar-link">Authors</a></li></ul></section></li></ul> </aside> <main class="page" data-v-92b43a16><header class="theme-default-content post-header" data-v-92b43a16><h1 data-v-92b43a16>Fee estimation for light-clients (Part 1)</h1> <p class="meta" data-v-0f148fb8 data-v-92b43a16>
  By

  <span data-v-0f148fb8><a href="/blog/author/Riccardo Casatta" class="meta-link" data-v-0f148fb8>Riccardo Casatta</a><!----></span>

  on

  1/26/2021

  - Tags:

  <span data-v-0f148fb8><a href="/blog/tags/fee" class="meta-link" data-v-0f148fb8>Fee</a>, </span><span data-v-0f148fb8><a href="/blog/tags/machine learning" class="meta-link" data-v-0f148fb8>Machine learning</a><!----></span></p> <hr data-v-92b43a16></header> <div class="theme-default-content content__default"><p>This post is part 1 of 3 of a series. (<a href="/blog/2021/01/fee-estimation-for-light-clients-part-2/">Part 2</a>, <a href="/blog/2021/01/fee-estimation-for-light-clients-part-3/">Part 3</a>)</p> <ul><li><a href="#introduction-what-is-fee-estimation">Introduction: what is fee estimation?</a></li> <li><a href="#the-problem">The problem</a> <ul><li><a href="#the-challenges-and-the-solution">The challenges and the solution</a></li> <li><a href="#the-question">The question</a></li> <li><a href="#the-data-logger">The data logger</a></li></ul></li></ul> <h2 id="introduction-what-is-fee-estimation"><a href="#introduction-what-is-fee-estimation" class="header-anchor">#</a> Introduction: what is fee estimation?</h2> <p>Fee estimation is the process of selecting the fee rate<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> for a bitcoin transaction being created, according to two main factors:</p> <ul><li>The current congestion of the Bitcoin network.</li> <li>The urgency, or lack thereof, for the transaction confirmation, i.e, its inclusion in a block.</li></ul> <p>A fee rate should be adequate to the above factors: a fee too high would be a waste of money, because the same result could have been achieved with a lower expense. On the other hand, a fee rate too low would wait for a confirmation longer than planned or, even worse, the transaction could not be confirmed at all.</p> <h2 id="the-problem"><a href="#the-problem" class="header-anchor">#</a> The problem</h2> <p>Bitcoin Core offers fee estimation through the <a href="https://bitcoincore.org/en/doc/0.20.0/rpc/util/estimatesmartfee/" target="_blank" rel="noopener noreferrer"><code>estimatesmartfee</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> RPC method, and there are also a lot of third-party <a href="https://b10c.me/blog/003-a-list-of-public-bitcoin-feerate-estimation-apis/" target="_blank" rel="noopener noreferrer">fee estimators<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> online, so do we need yet another estimator?</p> <p>The model used by Bitcoin Core is not well suited for light-clients such as mobile wallets, even when running in pruned mode. Online estimators are lacking in terms of:</p> <ul><li>Privacy: Contacting the server leaks your IP (unless you are using Tor or a VPN), and the request timing may be used to correlate the request to a transaction broadcasted to the network soon thereafter.</li> <li>Security: A malicious estimator could provide a high fee rate leading to a waste of money, or a low fee rate hampering the transaction confirmation.</li></ul> <p>Replace By Fee (RBF) and Child Pays For Parent (CPFP) are techniques that can somewhat minimize the fee estimation problem, because one could simply underestimate the fee rate and then raise it when necessary, however:</p> <ul><li>RBF and CPFP may leak more information, such as patterns that may allow to detect the kind of wallet used, or which one of the transaction outputs is the change.</li> <li>Requires additional interaction: the client must come back &quot;online&quot; to perform the fee bump. Sometimes this might be impractical or risky, for instance when using an offline signer or a multisignature with geographically distributed keys.</li></ul> <p>Thus, this work is an effort to build a <strong>good fee estimator for purely peer to peer light clients</strong> such as <a href="https://github.com/bitcoin/bips/blob/master/bip-0157.mediawiki" target="_blank" rel="noopener noreferrer">neutrino<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> based ones, or at least determine whether the approach we take is infeasible and open the discussion
for other, better, models.</p> <p>In the meantime, another sub-goal is pursued: attract the interest of data scientists; Indeed the initial step for this analysis consists in constructing a data set, which could also also help kickstart other studies on fee estimation or, more broadly, on the Bitcoin mempool.</p> <h4 id="the-challenges-and-the-solution"><a href="#the-challenges-and-the-solution" class="header-anchor">#</a> The challenges and the solution</h4> <p>The hardest part of doing fee estimation on a light client is the lack of information: for example, Bitcoin Core's <code>estimatesmartfee</code> uses up to the last 1008 blocks and knows everything about the mempool<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>, such as the fee rate of every transaction it contains, but a light-client does not.</p> <p>Also, there are other factors that may help doing fee estimation, such as the day of the week (the mempool usually empties during the <a href="https://www.blockchainresearchlab.org/2020/03/30/a-week-with-bitcoin-transaction-timing-and-transaction-fees/" target="_blank" rel="noopener noreferrer">weekend<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) or the time of the day to anticipate recurring daily events
(such as the batch of <a href="https://b10c.me/mempool-observations/2-bitmex-broadcast-13-utc/" target="_blank" rel="noopener noreferrer">bitmex withdrawals<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</p> <p>The idea is to apply Machine Learning (ML) techniques<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup> to discover patterns over what a light-client knows and see if they are enough to achieve consistently good estimations.</p> <h4 id="the-question"><a href="#the-question" class="header-anchor">#</a> The question</h4> <p>We are going to use a DNN (Deep Neural Network), a ML technique in the supervised learning branch. The &quot;ELI5&quot; is: give a lot of example inputs and the desired output to a black box; if there are correlations between inputs and outputs,
and there are enough examples, the black box will eventually start predicting the correct output even with inputs it has never seen before.</p> <p>To define our inputs and outputs, we need to start from the question we want to answer. For a fee estimator this is:</p> <p><em>&quot;Which minimum fee rate should I use if I want this transaction to be confirmed in at most <code>n</code> blocks?&quot;</em></p> <p>This can be translated to a table with many rows like:</p> <table><thead><tr><th>confirms_in</th> <th>other_information</th> <th>fee_rate</th></tr></thead> <tbody><tr><td>1</td> <td>...</td> <td>100.34</td></tr> <tr><td>2</td> <td>...</td> <td>84.33</td></tr> <tr><td>10</td> <td>...</td> <td>44.44</td></tr></tbody></table> <p>where the <code>fee_rate</code> column is the output we want, also called the &quot;<em>target</em>&quot; or &quot;<em>label</em>&quot; in ML terminology, and the other columns are our inputs.</p> <p>Can we build this table just by looking at the Bitcoin blockchain? Unfortunately, we can't:
The main thing that's missing is an indication of when the node first saw a transaction that has been later confirmed in a block. With that knowledge we can say that the fee rate of that transaction was the exact value required to confirm
within the number of blocks it actually took to be confirmed. For instance, if we see transaction <code>t</code> when the blockchain is at height <code>1000</code> and then we notice that <code>t</code> has been included in block <code>1006</code>, we can deduce that the
fee rate paid by <code>t</code> was the exact value required to get confirmed within the next <code>6</code> blocks.</p> <p>So to build our model, we first need to gather these data, and machine learning needs a <em>lot</em> of data to work well.</p> <h4 id="the-data-logger"><a href="#the-data-logger" class="header-anchor">#</a> The data logger</h4> <p>The <a href="https://github.com/RCasatta/bitcoin_logger" target="_blank" rel="noopener noreferrer">data logger<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is built with the purpose of collecting all the data we need, and it's MIT licensed open source software written in Rust.</p> <p>We need to register the moment in time when transactions enter in the node's mempool; to be efficient and precise we should not only call the RPC endpoints but listen to <a href="https://github.com/bitcoin/bitcoin/blob/master/doc/zmq.md" target="_blank" rel="noopener noreferrer">ZMQ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> events. Luckily, the just released bitcoin core 0.21.0 added a new <a href="https://github.com/bitcoin/bitcoin/blob/master/doc/zmq.md" target="_blank" rel="noopener noreferrer">ZMQ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> topic <code>zmqpubsequence</code> notifying mempool events (and block events). The logger is also listening to <code>zmqpubrawtx</code> and <code>zmqpubrawblock</code> topics, to make less RPC calls.</p> <p>We are not only interested in the timestamp of the transaction entering the mempool, but also how many blocks it will take until the same transaction is confirmed.
In the final dataset this field is called <code>confirms_in</code><sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup>; if <code>confirms_in = 1</code> it means the transaction is confirmed in the first block created after it has been seen for the first time.</p> <p>Another critical piece of information logged by the data logger is the <code>fee_rate</code> of the transaction, since the absolute fee value paid by a bitcoin transaction is not available nor derivable given only the transaction itself, as the inputs don't have explicit amounts.</p> <p>All these data (apart from the time of the transaction entering in the mempool) can actually be reconstructed simply by looking at the blockchain. However, querying the bitcoin node can be fairly slow, and during the model training iterations we want to recreate the ML dataset rapidly<sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup>, for example whenever we need to modify or add a new field.</p> <p>For these reasons, the logger is split into two parts: a process listening to the events sent by our node, which creates raw logs, and then a second process that uses these logs to create the final CSV dataset.
Raw logs are self-contained: for example, they contain all the previous transaction output values for every relevant transaction. This causes some redundancy, but in this case it's better to trade some efficiency for more performance
when recreating the dataset.</p> <figure><img src="/img/fee-estimation-for-light-clients/high-level-graph.svg" alt="High level graph"></figure> <p>My logger instance started collecting data on the 18th of December 2020, and as of today (25th January 2020), the raw logs are about 16GB.</p> <p>I expect (or at least hope) the raw logs, the CSV dataset, or the data logger will be useful also for other projects as well, like monitoring the propagation of transactions or other works involving raw mempool data. We will share raw logs data through torrent soon.</p> <p>In the following <a href="/blog/2021/01/fee-estimation-for-light-clients-part-2/">Part 2</a> we are going to talk about the dataset.</p> <hr class="footnotes-sep"> <section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>The transaction fee rate is the ratio between the absolute fee expressed in satoshi, over the weight of the transaction measured in virtual bytes. The weight of the transaction is similar to the byte size, however a part of the transaction (the segwit part) is discounted, their byte size is considered less because it creates less burden for the network. <a href="#fnref1" class="footnote-backref">↩︎</a></p></li> <li id="fn2" class="footnote-item"><p>mempool is the set of transactions that are valid by consensus rules (for example, they are spending existing bitcoin), broadcasted in the bitcoin peer to peer network, but they are not yet part of the blockchain. <a href="#fnref2" class="footnote-backref">↩︎</a></p></li> <li id="fn3" class="footnote-item"><p>DISCLAIMER: I am not an expert data-scientist! <a href="#fnref3" class="footnote-backref">↩︎</a></p></li> <li id="fn4" class="footnote-item"><p>Conceptually similar to bitcoin core <code>estimatesmartfee</code> parameter called &quot;blocks target&quot;, however, <code>confirms_in</code> is the real value not the desired target. <a href="#fnref4" class="footnote-backref">↩︎</a></p></li> <li id="fn5" class="footnote-item"><p>16GB of compressed raw logs are processed and a compressed CSV produced in about 5 minutes. <a href="#fnref5" class="footnote-backref">↩︎</a></p></li></ol></section></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/bitcoindevkit/bitcoindevkit.org/edit/master/docs/_blog/fee_estimation_for_light_clients_part_1.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/21/2024, 4:44:27 PM</span></div></footer> <!----> </main></div></div> <footer class="footer" data-v-b812d5fc><div class="wrap"><div class="wrap-border"><div class="inner"><div class="footer-content"><div class="footer-block"><h4>Docs</h4> <div><a href="/getting-started/" class="nav-link">
  Getting Started
</a></div><div><a href="/bdk-cli/installation/" class="nav-link">
  BDK-CLI
</a></div><div><a href="/descriptors/" class="nav-link">
  Descriptors
</a></div></div><div class="footer-block"><h4>Community</h4> <div><a href="https://github.com/bitcoindevkit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div><a href="nostr:npub13dk3dke4zm9vdkucm7f6vv7vhqgkevgg3gju9kr2wzumz7nrykdq0dgnvc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nostr
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div><a href="https://twitter.com/intent/follow?screen_name=bitcoindevkit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div><a href="https://discord.gg/dstn4dQ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat on Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></div><div class="footer-block"><h4>More</h4> <div><a href="/blog/" class="nav-link router-link-active">
  Blog
</a></div><div><a href="/foundation/supporters/" class="nav-link">
  Supporters
</a></div><div><a href="/foundation/" class="nav-link">
  BDK Foundation
</a></div></div></div> <p class="copyright">Copyright © 2024 BDK Developers</p></div></div></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b7fe13ec.js" defer></script><script src="/assets/js/4.421e1146.js" defer></script><script src="/assets/js/1.519cc26e.js" defer></script><script src="/assets/js/59.9b9541ac.js" defer></script>
  </body>
</html>
