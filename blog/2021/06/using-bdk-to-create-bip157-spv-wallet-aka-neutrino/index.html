<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using BDK to create BIP157 SPV wallet (aka Neutrino) | Bitcoin Dev Kit Documentation</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="preload" href="/fonts/ibm-plex-mono-400.woff2" as="font" crossorigin="true">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="stylesheet" href="/css/variables.css">
    <link name="msapplication-config" content="/browserconfig.xml">
    <link name="msapplication-TileColor" content="#ffffff">
    <link name="theme-color" content="#ffffff">
    <meta name="description" content="Tutorial showing usage of compact filters (BIP157) using bdk-cli command line tools">
    <meta property="article:published_time" content="2021-06-20T00:00:00.000Z">
    <meta property="og:site_name" content="Bitcoin Dev Kit Documentation">
    <meta property="og:title" content="Using BDK to create BIP157 SPV wallet (aka Neutrino)">
    <meta property="og:description" content="Tutorial showing usage of compact filters (BIP157) using bdk-cli command line tools">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://bitcoindevkit.org/blog/2021/06/using-bdk-to-create-bip157-spv-wallet-aka-neutrino/">
    <meta property="og:image" content="https://bitcoindevkit.org/card.png">
    <meta name="twitter:title" content="Using BDK to create BIP157 SPV wallet (aka Neutrino)">
    <meta name="twitter:description" content="Tutorial showing usage of compact filters (BIP157) using bdk-cli command line tools">
    <meta name="twitter:url" content="https://bitcoindevkit.org/blog/2021/06/using-bdk-to-create-bip157-spv-wallet-aka-neutrino/">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="https://bitcoindevkit.org/card.png">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="tutorial, BDK, bdk-cli, compact_filters, BIP157, Neutrino">
    <meta property="article:tag" content="tutorial">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    
    <link rel="preload" href="/assets/css/0.styles.b24aebc5.css" as="style"><link rel="preload" href="/assets/js/app.5d09363a.js" as="script"><link rel="preload" href="/assets/js/8.cbf41989.js" as="script"><link rel="preload" href="/assets/js/1.e424882b.js" as="script"><link rel="preload" href="/assets/js/17.3efb05a1.js" as="script"><link rel="prefetch" href="/assets/js/10.9a67fe95.js"><link rel="prefetch" href="/assets/js/11.893b3d04.js"><link rel="prefetch" href="/assets/js/12.5cdf14d4.js"><link rel="prefetch" href="/assets/js/13.f3d94d80.js"><link rel="prefetch" href="/assets/js/14.9d333dd1.js"><link rel="prefetch" href="/assets/js/15.65c46ddb.js"><link rel="prefetch" href="/assets/js/16.3f3dddaf.js"><link rel="prefetch" href="/assets/js/18.a24d0741.js"><link rel="prefetch" href="/assets/js/19.1ff07f8b.js"><link rel="prefetch" href="/assets/js/20.64f82651.js"><link rel="prefetch" href="/assets/js/21.c2a78f63.js"><link rel="prefetch" href="/assets/js/22.7857514e.js"><link rel="prefetch" href="/assets/js/23.ee15c71e.js"><link rel="prefetch" href="/assets/js/24.dd41f47c.js"><link rel="prefetch" href="/assets/js/25.6d44ee16.js"><link rel="prefetch" href="/assets/js/26.0b3c80e5.js"><link rel="prefetch" href="/assets/js/27.4c3ccb74.js"><link rel="prefetch" href="/assets/js/28.2866e08a.js"><link rel="prefetch" href="/assets/js/29.a4f8e7a7.js"><link rel="prefetch" href="/assets/js/30.4cca13f2.js"><link rel="prefetch" href="/assets/js/31.a1e68a26.js"><link rel="prefetch" href="/assets/js/32.2eb3191a.js"><link rel="prefetch" href="/assets/js/33.a6fd33d0.js"><link rel="prefetch" href="/assets/js/34.8a2ca964.js"><link rel="prefetch" href="/assets/js/35.561626e7.js"><link rel="prefetch" href="/assets/js/36.7a33ad49.js"><link rel="prefetch" href="/assets/js/37.a6439799.js"><link rel="prefetch" href="/assets/js/38.830917f2.js"><link rel="prefetch" href="/assets/js/39.c8877335.js"><link rel="prefetch" href="/assets/js/40.acab6ee8.js"><link rel="prefetch" href="/assets/js/41.b2ca0ab3.js"><link rel="prefetch" href="/assets/js/42.d9806851.js"><link rel="prefetch" href="/assets/js/43.c44e7e24.js"><link rel="prefetch" href="/assets/js/44.cad5eecc.js"><link rel="prefetch" href="/assets/js/45.918f1ac9.js"><link rel="prefetch" href="/assets/js/46.da69450a.js"><link rel="prefetch" href="/assets/js/5.8b5dddc4.js"><link rel="prefetch" href="/assets/js/6.22609606.js"><link rel="prefetch" href="/assets/js/7.1fff5745.js"><link rel="prefetch" href="/assets/js/9.18c7fd01.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.45087a28.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.8696e0bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b24aebc5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-9ca807bc data-v-5a6fa056><header class="navbar" data-v-9ca807bc><div class="wrap"><div class="wrap-border"><a href="/" class="home-link router-link-active"><svg role="img" alt="Bitcoin Dev Kit Documentation" class="logo"><use href="/img/logo.svg#small" class="small"></use> <use href="/img/logo.svg#large" class="large"></use></svg></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/getting-started/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="/tutorials/hello-world.html" class="nav-link">
  Tutorials
</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  Blog
</a></div><div class="nav-item"><a href="https://discord.gg/dstn4dQ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/bitcoindevkit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/bitcoindevkit/bitcoindevkit.org" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <button type="button" class="theme-switch"><svg viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg"><g class="theme-switch-dark"><path d="M15 20.4219C12.5187 20.4219 10.5 18.4032 10.5 15.9219C10.5 13.4406 12.5187 11.4219 15 11.4219C17.4813 11.4219 19.5 13.4406 19.5 15.9219C19.5 18.4032 17.4813 20.4219 15 20.4219Z" fill="currentColor"></path> <path d="M19.4541 20.3769L21.3644 22.2862M15 24.9219V22.2219V24.9219ZM15 9.62187V6.92188V9.62187ZM6 15.9219H8.7H6ZM21.3 15.9219H24H21.3ZM8.6361 22.2862L10.5454 20.3769L8.6361 22.2862ZM19.4541 11.4678L21.3644 9.55797L19.4541 11.4678ZM8.6361 9.55797L10.5454 11.4678L8.6361 9.55797Z" stroke="currentColor" stroke-width="1" stroke-linecap="round"></path></g> <g fill="currentColor" class="theme-switch-light"><path d="M10.1539 8.75585C10.018 8.75585 9.88774 8.70189 9.79168 8.60583C9.69563 8.50977 9.64166 8.37949 9.64166 8.24365V6.19482C9.64166 6.05898 9.69563 5.9287 9.79168 5.83264C9.88774 5.73658 10.018 5.68262 10.1539 5.68262C10.2897 5.68262 10.42 5.73658 10.5161 5.83264C10.6121 5.9287 10.6661 6.05898 10.6661 6.19482V8.24365C10.6661 8.37949 10.6121 8.50977 10.5161 8.60583C10.42 8.70189 10.2897 8.75585 10.1539 8.75585Z"></path> <path d="M11.1783 7.73144H9.12945C8.9936 7.73144 8.86332 7.67748 8.76726 7.58142C8.6712 7.48536 8.61724 7.35508 8.61724 7.21924C8.61724 7.08339 8.6712 6.95311 8.76726 6.85705C8.86332 6.761 8.9936 6.70703 9.12945 6.70703H11.1783C11.3141 6.70703 11.4444 6.761 11.5405 6.85705C11.6365 6.95311 11.6905 7.08339 11.6905 7.21924C11.6905 7.35508 11.6365 7.48536 11.5405 7.58142C11.4444 7.67748 11.3141 7.73144 11.1783 7.73144ZM6.05621 13.8779C5.92037 13.8779 5.79009 13.8239 5.69403 13.7279C5.59797 13.6318 5.54401 13.5015 5.54401 13.3657V12.3413C5.54401 12.2054 5.59797 12.0752 5.69403 11.9791C5.79009 11.8831 5.92037 11.8291 6.05621 11.8291C6.19206 11.8291 6.32234 11.8831 6.4184 11.9791C6.51445 12.0752 6.56842 12.2054 6.56842 12.3413V13.3657C6.56842 13.5015 6.51445 13.6318 6.4184 13.7279C6.32234 13.8239 6.19206 13.8779 6.05621 13.8779Z"></path> <path d="M6.56842 13.366H5.544C5.40816 13.366 5.27788 13.312 5.18182 13.216C5.08576 13.1199 5.0318 12.9896 5.0318 12.8538C5.0318 12.7179 5.08576 12.5877 5.18182 12.4916C5.27788 12.3955 5.40816 12.3416 5.544 12.3416H6.56842C6.70426 12.3416 6.83454 12.3955 6.9306 12.4916C7.02666 12.5877 7.08062 12.7179 7.08062 12.8538C7.08062 12.9896 7.02666 13.1199 6.9306 13.216C6.83454 13.312 6.70426 13.366 6.56842 13.366ZM16.8125 23.6101C12.8583 23.6101 9.64165 20.3934 9.64165 16.4392C9.64165 12.8983 12.2851 9.85021 15.7907 9.34876L16.4658 9.25195L16.37 9.92755C16.326 10.218 16.3027 10.5112 16.3003 10.805C16.3003 14.1942 19.0575 16.9514 22.4468 16.9514C22.708 16.9514 22.9872 16.9294 23.3247 16.8813L23.9998 16.7855L23.9035 17.4606C23.401 20.9666 20.3524 23.6101 16.8125 23.6101Z"></path></g></svg></button></div> <div class="sidebar-button"><svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="icon"><g fill="currentColor" class="hamburger"><path d="M33.75 11.6699H6.25C5.55964 11.6699 5 12.2296 5 12.9199C5 13.6103 5.55964 14.1699 6.25 14.1699H33.75C34.4404 14.1699 35 13.6103 35 12.9199C35 12.2296 34.4404 11.6699 33.75 11.6699Z"></path> <path d="M28.75 18.752H6.25C5.55964 18.752 5 19.3116 5 20.002C5 20.6923 5.55964 21.252 6.25 21.252H28.75C29.4404 21.252 30 20.6923 30 20.002C30 19.3116 29.4404 18.752 28.75 18.752Z"></path> <path d="M33.75 25.8301H6.25C5.55964 25.8301 5 26.3897 5 27.0801C5 27.7704 5.55964 28.3301 6.25 28.3301H33.75C34.4404 28.3301 35 27.7704 35 27.0801C35 26.3897 34.4404 25.8301 33.75 25.8301Z"></path></g> <g stroke="currentColor" class="close"><path d="M10 10L30 30" stroke-width="2" stroke-linecap="round"></path> <path d="M30 10L10 30" stroke-width="2" stroke-linecap="round"></path></g></svg></div></div></div></header> <div class="wrap" data-v-9ca807bc><div class="wrap-border" data-v-9ca807bc><div class="sidebar-mask" data-v-9ca807bc></div> <aside class="sidebar" data-v-9ca807bc><nav class="nav-links"><div class="nav-item"><a href="/getting-started/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="/tutorials/hello-world.html" class="nav-link">
  Tutorials
</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  Blog
</a></div><div class="nav-item"><a href="https://discord.gg/dstn4dQ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/bitcoindevkit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/bitcoindevkit/bitcoindevkit.org" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Blog</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/" aria-current="page" class="sidebar-link">Articles</a></li><li><a href="/blog/tags/" class="sidebar-link">Tags</a></li><li><a href="/blog/author/" class="sidebar-link">Authors</a></li></ul></section></li></ul> </aside> <main class="page" data-v-5a6fa056><header class="theme-default-content post-header" data-v-5a6fa056><h1 data-v-5a6fa056>Using BDK to create BIP157 SPV wallet (aka Neutrino)</h1> <p class="meta" data-v-070abed8 data-v-5a6fa056>
  By

  <span data-v-070abed8><a href="/blog/author/Rajarshi Maitra" class="meta-link" data-v-070abed8>Rajarshi Maitra</a><!----></span>

  on

  6/21/2021

  - Tags:

  <span data-v-070abed8><a href="/blog/tags/tutorial" class="meta-link" data-v-070abed8>Tutorial</a>, </span><span data-v-070abed8><a href="/blog/tags/BDK" class="meta-link" data-v-070abed8>BDK</a>, </span><span data-v-070abed8><a href="/blog/tags/bdk-cli" class="meta-link" data-v-070abed8>Bdk-cli</a>, </span><span data-v-070abed8><a href="/blog/tags/compact_filters" class="meta-link" data-v-070abed8>Compact_filters</a>, </span><span data-v-070abed8><a href="/blog/tags/BIP157" class="meta-link" data-v-070abed8>BIP157</a>, </span><span data-v-070abed8><a href="/blog/tags/Neutrino" class="meta-link" data-v-070abed8>Neutrino</a><!----></span></p> <hr data-v-5a6fa056></header> <div class="theme-default-content content__default"><h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <h4 id="compact-filters"><a href="#compact-filters" class="header-anchor">#</a> Compact Filters:</h4> <p>Compact filters are the latest specification of Bitcoin SPV node implementation as per <a href="https://github.com/bitcoin/bips/blob/master/bip-0157.mediawiki" target="_blank" rel="noopener noreferrer">BIP157<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://github.com/bitcoin/bips/blob/master/bip-0158.mediawiki" target="_blank" rel="noopener noreferrer">BIP158<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Such light clients were envisioned by Satoshi himself in  his original white paper, but due to lack of robust privacy and trust guarantees using conventional <a href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki" target="_blank" rel="noopener noreferrer">bloomfilters<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, these type of nodes never got popular.</p> <p>Enters <a href="https://github.com/bitcoin/bips/blob/master/bip-0157.mediawiki" target="_blank" rel="noopener noreferrer">BIP157<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which described a new type of filters for Bitcoin Blockchain data, known as <code>compact_filters</code>. The <a href="https://github.com/lightninglabs/neutrino" target="_blank" rel="noopener noreferrer">Neutrino<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> project pioneered the use of compact filter based light client nodes for using with Lightning Network wallets. Using compact filters, a light-node can talk to one or more full nodes, and fetch relevant information from the blockchain, with much more robust privacy and security guarantees than previously possible. Compact filter based nodes are best suitable to be used with mobile wallets, to create more trustless mobile applications on Bitcoin. Any wallet application that needs to have an &quot;eye on the blockchain&quot; has an use for such light clients.</p> <p><code>BIP157</code> type filters allows to create tiny sized SPV nodes, that can fetch blockchain data and can identify inconsistency, so it can actively defend itself, while also preserving its privacy. Such nodes are most useful for Lightning Network mobile applications.</p> <p>Example of such <code>compact_filters</code> wallets in wild is <a href="https://github.com/breez/breezmobile" target="_blank" rel="noopener noreferrer">Breeze<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Lightning mobile wallet.</p> <p>Bitcoin core supports serving <code>BIP157</code> type filters from <code>v0.21.0</code>.</p> <h4 id="bdk-and-compact-filters"><a href="#bdk-and-compact-filters" class="header-anchor">#</a> BDK and Compact filters</h4> <p>BDK is a bitcoin wallet development library that can be used to create bitcoin wallets with custom <code>Database</code> and <code>Blockchain</code> backends. BDK is a <a href="https://bitcoindevkit.org/descriptors/" target="_blank" rel="noopener noreferrer">descriptor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> based wallet, i.e. the wallet keychain is described by a set of descriptors.</p> <p>Using BDK one can instantiate wallets of various kinds as per requirement. BDK abstracts away all the heavy lifting works, and allow wallet devs to concentrate on logic that they care about, i.e. writing wallet codes. For more detailed documentation on BDK capabilities check these <a href="https://bitcoindevkit.org/blog/2020/12/hello-world/" target="_blank" rel="noopener noreferrer">blog<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://bitcoindevkit.org/blog/2020/11/descriptors-in-the-wild/" target="_blank" rel="noopener noreferrer">bog<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://docs.rs/bdk/" target="_blank" rel="noopener noreferrer">docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>The main three components of abstraction in BDK are</p> <ul><li><code>Database</code></li> <li><code>Descriptors</code></li> <li><code>Blockchain</code></li></ul> <p>BDK comes with default implementations of all them that developers can start with out of the box. Developers can also create there own custom implementations and plug it into BDK (thanks to rust magic of <code>Traits</code>).</p> <p>BDK also supports <a href="https://github.com/bitcoin/bips/blob/master/bip-0158.mediawiki" target="_blank" rel="noopener noreferrer">BIP158<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> communication protocol, which allows creation of <code>BIP157</code> type compact filter SPV nodes. This capability is extended to wallet with BDK's <code>Blockchain</code> data structure. The <a href="https://docs.rs/bdk/0.8.0/bdk/blockchain/trait.Blockchain.html" target="_blank" rel="noopener noreferrer">API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for <code>compact_filters</code> backend is similar to any other kind of backends, so wallet devs don't need to worry about all the details. Its ok if the dev haven't even heard of <code>BIP157</code>, BDK takes care of that in background.</p> <p>This capability can be unlocked by compiling BDK with the <code>compact_filters</code> feature. Once enabled, BDK will be able to create wallets with the <code>compact_filters</code> type <code>Blockchain</code> backend. (The default backend is electrum server)</p> <h4 id="bdk-cli"><a href="#bdk-cli" class="header-anchor">#</a> bdk-cli</h4> <p><code>bdk-cli</code> is a lightweight <a href="https://codewith.mu/en/tutorials/1.0/repl" target="_blank" rel="noopener noreferrer">REPL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> wrapper over the BDK library to facilitate quick and easy demonstration of BDK capabilities in command-line. Wallet devs can use this tool to quickly try out different possibilities with BDK.</p> <p>In this tutorial, We will use <code>bdk-cli</code> to demonstrate some basic wallet functionalities using <code>compact_filters</code> backend.</p> <h2 id="tutorial-scope"><a href="#tutorial-scope" class="header-anchor">#</a> Tutorial Scope</h2> <p>Basic wallet workflow we will cover:</p> <ul><li>create and sync a wallet,</li> <li>receive a transaction,</li> <li>create a transaction,</li> <li>sign and broadcast the transaction,</li> <li>fetch updated balance,</li></ul> <p>The BDK wallet will have a <code>BIP157</code> SPV backend (aka <code>compact_filters</code> backend) that will connect with a Bitcoin core node serving filter data.</p> <p>It will publish and extract transaction data through that node.</p> <p>We will have a Bitcoin Core wallet and a BDK wallet, sending and receiving transactions between each other, in regtest.</p> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <p>Following things are required to start with the tutorial.</p> <ol><li>A Bitcoin Core regtest node listening at <code>localhost:18444</code> signalling for compact filter support.</li> <li><code>bdk-cli</code> compiled with <code>compact_filter</code> features.</li></ol> <p>If you already have these two setup and working, you can skip this and jump to the <a href="#tutorial">Tutorial</a> section.</p> <h4 id="install-and-run-bitcoind"><a href="#install-and-run-bitcoind" class="header-anchor">#</a> Install and run <code>bitcoind</code></h4> <p>You can definitely do it with your own <code>bitcoind</code> installation. <code>BIP157</code> support has been included in Bitcoin Core <code>v0.21.0</code>. So anything above that will work.</p> <p>You also need to ensure proper configuration settings for signalling <code>compact_filters</code> support.</p> <p>For ease of testing, the BDK project hosts docker images that can be used to spawn Bitcoin Core with all the relevant configurations.</p> <ul><li><p>spawn a regtest node using <a href="https://github.com/bitcoindevkit/bitcoin-regtest-box" target="_blank" rel="noopener noreferrer">bitcoin-regtest-box<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> docker file.</p> <p>Start the regtest box docker container.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ docker run --detach --rm -p <span class="token number">127.0</span>.0.1:18443-18444:18443-18444/tcp --name bdk-box bitcoindevkit/bitcoind
</code></pre></div><p>This will spin up a docker container running <code>bicoind</code> and listening to port <code>18444</code> and <code>18333</code>. You can keep this terminal alive to see communication events with BDK and the node.</p></li> <li><p>Check node is reachable</p> <p>In another terminal try connecting to the node with <code>bitcoin-cli</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ docker <span class="token builtin class-name">exec</span> -it bdk-box /root/bitcoin-cli -regtest getnetworkinfo
<span class="token punctuation">{</span>
  <span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span> <span class="token number">210000</span>,
  <span class="token string">&quot;subversion&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/Satoshi:0.21.1/&quot;</span>,
  <span class="token string">&quot;protocolversion&quot;</span><span class="token builtin class-name">:</span> <span class="token number">70016</span>,
  <span class="token string">&quot;localservices&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0000000000000449&quot;</span>,
  <span class="token string">&quot;localservicesnames&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;NETWORK&quot;</span>,
    <span class="token string">&quot;WITNESS&quot;</span>,
    <span class="token string">&quot;COMPACT_FILTERS&quot;</span>,
    <span class="token string">&quot;NETWORK_LIMITED&quot;</span>
    <span class="token punctuation">..</span>.
  <span class="token punctuation">]</span>,
<span class="token punctuation">}</span>

</code></pre></div><p>In the output, the <code>version</code> should show <code>210000</code>. <code>localservicesnames</code> should contain <code>&quot;COMPACT_FILTERS&quot;</code>. If you see this, then Bitcoin Core is correctly configured.</p></li></ul> <h4 id="install-and-run-bdk-cli"><a href="#install-and-run-bdk-cli" class="header-anchor">#</a> Install and run bdk-cli</h4> <ul><li><p>Install <code>bdk-cli</code> with <code>compact_filters</code> feature</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ cargo <span class="token function">install</span> --git https://github.com/bitcoindevkit/bdk-cli.git bdk-cli --features compact_filters
</code></pre></div></li> <li><p>Check installation</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ bdk-cli --help
<span class="token punctuation">..</span>.
USAGE:
    bdk-cli <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> <span class="token operator">&lt;</span>SUBCOMMAND<span class="token operator">&gt;</span>
FLAGS:
    -h, --help Prints <span class="token builtin class-name">help</span> information
    -V, --version Prints version information
OPTIONS:
    -n, --network <span class="token operator">&lt;</span>NETWORK<span class="token operator">&gt;</span> Sets the network <span class="token punctuation">[</span>default: testnet<span class="token punctuation">]</span>

SUBCOMMANDS:
    <span class="token builtin class-name">help</span>      Prints this message or the <span class="token builtin class-name">help</span> of the given subcommand<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    key       Key management sub-commands
    repl      Enter REPL <span class="token builtin class-name">command</span> loop mode
    wallet    Wallet options and sub-commands
</code></pre></div></li></ul> <p>Once these are setup correctly, you can start with the tutorial next.</p> <h2 id="tutorial"><a href="#tutorial" class="header-anchor">#</a> Tutorial</h2> <p>[Note: For brevity <code>bdk-cli</code> results are stored in command line variables using <code>jq</code> tool. It is recommended to check the full results to see different information returned by <code>bdk-cli</code> commands.]</p> <h3 id="bitcoin-core-wallet-generation"><a href="#bitcoin-core-wallet-generation" class="header-anchor">#</a> Bitcoin Core Wallet Generation</h3> <p>This is standard procedure with <code>bitcoin-cli</code>.</p> <ul><li><p>Create a wallet and generate 101 blocks.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ docker <span class="token builtin class-name">exec</span> -it bdk-box /root/bitcoin-cli -regtest createwallet <span class="token builtin class-name">test</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;test&quot;</span>,
  <span class="token string">&quot;warning&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>$ docker <span class="token builtin class-name">exec</span> -it bdk-box /root/bitcoin-cli -regtest getnewaddress
bcrt1qatd7yq0jukwusuaufltlejmeydpvnpv43r5gc2
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>$ docker <span class="token builtin class-name">exec</span> -it bdk-box /root/bitcoin-cli -regtest generatetoaddress <span class="token number">101</span> bcrt1qatd7yq0jukwusuaufltlejmeydpvnpv43r5gc2
<span class="token punctuation">[</span>
<span class="token string">&quot;3813ed6eb716f4743b9657d918799acf743add985a8ded28d8aa3629dd4496b6&quot;</span>,
<span class="token string">&quot;70da855913bdf791b6e458c611cebdef79b7a9840eb103ce58c71c1c7e3c49bc&quot;</span>,
<span class="token string">&quot;682ca732ef72719cd6f82c5047c7690fb1cd2df2543d035ac4ea99e974b8d172&quot;</span>,
<span class="token string">&quot;78799e4771017d4f46aa3c240054e2d61f54cea07ec44cb18ae712761e0aaa1e&quot;</span>,
<span class="token punctuation">..</span>.
<span class="token punctuation">]</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>$ docker <span class="token builtin class-name">exec</span> -it bdk-box /root/bitcoin-cli -regtest getbalance
<span class="token number">50.00000000</span>
</code></pre></div><p>Now the core wallet has generated new blocks and is funded with test bitcoin.</p></li></ul> <h3 id="bdk-wallet-generation"><a href="#bdk-wallet-generation" class="header-anchor">#</a> BDK Wallet Generation</h3> <p>BDK is a descriptor based wallet library. So in order to use it we will need some descriptors to work with.</p> <p>BDK wallet will ask for two descriptors as input, corresponding to <code>receive</code> and <code>change</code> addresses. Its recommended to have these two descriptors separate as BDK will handle them separately and ensure <code>change</code> addresses are never used for receiving funds.</p> <p>Or developers can decide to use a single descriptor too, in that case BDK will use that descriptor for deriving both <code>receive</code> and <code>change</code> addresses.</p> <p>We will use <code>bdk-cli</code> itself to generate such descriptors.</p> <ul><li><h4 id="generate-a-privatekey"><a href="#generate-a-privatekey" class="header-anchor">#</a> Generate a privatekey</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token assign-left variable">BDK_xprv</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>bdk-cli key generate <span class="token operator">|</span> jq -r <span class="token string">'.xprv'</span><span class="token variable">)</span></span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">$BDK_xprv</span>
tprv8ZgxMBicQKsPefY7tdq7EKny81n9tfSvUYfSHAZByXdjPAZVysvaB6sFd2YavqfqMBgbHaXUG5oWM6sYvdJn6vnUizzQKTYAJ36bQsfPv4N
</code></pre></div><p><code>bdk-cli key generate</code> will generate a fresh master key with <code>mnemonic</code> and <code>xprv</code>. We have extracted the value of extended private key and stored it in <code>BDK_xprv</code> variable.</p> <p>The returned <code>mnemonic</code> can be used to restore back the wallet if wallet data directory is lost.</p></li> <li><h4 id="generate-descriptors"><a href="#generate-descriptors" class="header-anchor">#</a> Generate Descriptors</h4> <p><code>bdk-cli key derive</code> can derive an <code>xpub</code>s given a <code>master key</code> and <code>derivation_path</code>.</p> <p>We will use the following paths for our <code>receive</code> and <code>change</code> descriptors</p> <ul><li><code>receive</code> path: <code>m/84h/1h/0h/0</code></li> <li><code>change</code> path: <code>m/84h/1h/0h/1</code>,</li></ul> <p>We can then simply wrap them in a <code>&quot;wpkh()&quot;</code> to create our descriptors string and store them.</p> <p>When asked for a new address, BDK will derive one from the <code>receive</code> descriptor.</p> <p>And while constructing transaction, BDK will use the <code>change</code> descriptor to derive change address.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token assign-left variable">BDK_recv_desc</span><span class="token operator">=</span><span class="token string">&quot;wpkh(<span class="token variable"><span class="token variable">$(</span>bdk-cli key derive --path m/84h/1h/0h/0 --xprv $BDK_xprv <span class="token operator">|</span> jq -r <span class="token string">'.xprv'</span><span class="token variable">)</span></span>)&quot;</span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">$BDK_recv_desc</span>
wpkh<span class="token punctuation">(</span><span class="token punctuation">[</span>ff09c7c9/84<span class="token string">'/1'</span>/0'/0<span class="token punctuation">]</span>tprv8hkdEGgwLLnqsdfkJFidpTj5d6z5qFdP6Qwzsviea3HrS9C2mXXaDivPKCCgcaWvnGNX9eciLUQs91PWYXJqrChfnAagViCgG6L5phaNyWr/*<span class="token punctuation">)</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token assign-left variable">BDK_chng_desc</span><span class="token operator">=</span><span class="token string">&quot;wpkh(<span class="token variable"><span class="token variable">$(</span>bdk-cli key derive --path m/84h/1h/0h/1 --xprv $BDK_xprv <span class="token operator">|</span> jq -r <span class="token string">'.xprv'</span><span class="token variable">)</span></span>)&quot;</span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">$BDK_chng_desc</span>
wpkh<span class="token punctuation">(</span><span class="token punctuation">[</span>ff09c7c9/84<span class="token string">'/1'</span>/0'/1<span class="token punctuation">]</span>tprv8hkdEGgwLLnqtbYkGG7fSy7v43RF2SQGGjNuZtmBzEHh7H8xgpXBETQAbVPqi8rkvLNFKLYY4rDzXA4fn5Ha1yuazZqhQPe3uNKmFS7648s/*<span class="token punctuation">)</span>
</code></pre></div><p>Note: <code>BDK_xprv</code> has been used as the <code>master key</code>, this will allow BDK to have signing capabilities.
We could have used an <code>xpub</code> master key here instead, that would create an <code>watch-only</code> wallet.</p></li> <li><h4 id="create-and-sync-a-wallet"><a href="#create-and-sync-a-wallet" class="header-anchor">#</a> Create and Sync a wallet</h4> <p>We will now instruct BDK to create a new wallet with following instructions</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ bdk-cli --network regtest wallet --node <span class="token string">&quot;127.0.0.1:18444&quot;</span> --wallet bdk-test -d <span class="token variable">$BDK_recv_desc</span> -c <span class="token variable">$BDK_chng_desc</span> <span class="token function">sync</span>
<span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>name (<code>--wallet</code>) <code>bdk-test</code>,</li> <li><code>receive</code> descriptor (<code>-d</code>) as <code>$BDK_recv_desc</code> and change descriptor (<code>-c</code>) as <code>$BDK_chng_desc</code>,</li> <li>connected to a full node (<code>--node</code>) listening at <code>127.0.0.1:18444</code>,</li> <li>and finally create and sync the wallet with the <code>sync</code> command.</li></ul> <p>If you are using a <code>regtest</code> node, also add <code>--network regtest</code>, the default is <code>testnet</code>.</p> <p><code>bdk-cli</code> makes multiple parallel connections that can be configured with the <code>--conn-count</code> parameter (default is 4). This makes syncing parallel and fast. Use <code>bdk-cli --help</code> to see all other options.</p> <p>Getting an empty return means wallet creation succeeded.</p> <p>BDK has created a wallet named <code>bdk-test</code> in its data directory. Which is by default stored at <code>~/.bdk-bitcoin/compact_filters</code> folder.</p> <p>Looking into that folder different files and directories maintained by BDK can be seen.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">ls</span> .bdk-bitcoin/compact_filters/
000004.log  CURRENT   LOCK  MANIFEST-000003  OPTIONS-000010
bdk-test    IDENTITY  LOG   OPTIONS-000008
</code></pre></div></li></ul> <h3 id="recieve-coins"><a href="#recieve-coins" class="header-anchor">#</a> Recieve Coins</h3> <p>We will use the <code>core</code> wallet to send 5 BTC to our<code>bdk-test</code> wallet.</p> <ul><li><p>Fetch a new address using <code>bdk-cli</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ bdk-cli --network regtest wallet --node <span class="token string">&quot;127.0.0.1:18444&quot;</span> --wallet bdk-test -d <span class="token variable">$BDK_recv_desc</span> -c <span class="token variable">$BDK_chng_desc</span> get_new_address
<span class="token punctuation">{</span>
  <span class="token string">&quot;address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bcrt1qx2479wywulf50pqx5uy64zhxq9f3tuvlh8u0s9&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>Transfer funds to the previous address and generate a block, using <code>bitcoin-cli</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ docker <span class="token builtin class-name">exec</span> -it bdk-box /root/bitcoin-cli -regtest sendtoaddress bcrt1qx2479wywulf50pqx5uy64zhxq9f3tuvlh8u0s9 <span class="token number">5</span>


$ docker <span class="token builtin class-name">exec</span> -it bdk-box /root/bitcoin-cli -regtest generatetoaddress <span class="token number">1</span> bcrt1qw3ht9xtc9pgyvmqay0ap9fw8mxd27az8el0uz3
</code></pre></div><p><code>core</code> has sent 5 BTC to our <code>bdk-test</code> wallet. Which is confirmed in a new block.</p> <p><code>bdk-test</code> can see that now by syncing again.</p> <p>(Note: BDK required explicit <code>sync()</code> calls to give wallet developers flexibility on when to sync).</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ bdk-cli --network regtest wallet --node <span class="token string">&quot;127.0.0.1:18444&quot;</span> --wallet bdk-test -d <span class="token variable">$BDK_recv_desc</span> -c <span class="token variable">$BDK_chng_desc</span> <span class="token function">sync</span>
<span class="token punctuation">{</span><span class="token punctuation">}</span>

$ bdk-cli --network regtest wallet --node <span class="token string">&quot;127.0.0.1:18444&quot;</span> --wallet bdk-test -d <span class="token variable">$BDK_recv_desc</span> -c <span class="token variable">$BDK_chng_desc</span> get_balance
<span class="token punctuation">{</span>
  <span class="token string">&quot;satoshi&quot;</span><span class="token builtin class-name">:</span> <span class="token number">500000000</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We can see <code>500000000</code> sats balance in our <code>bdk-test</code> wallet.</p> <p>BDK has fetched blockchain details concerning its wallet descriptors, from the core node, using compact filters.</p></li></ul> <h3 id="creating-a-transaction"><a href="#creating-a-transaction" class="header-anchor">#</a> Creating a transaction.</h3> <p>Now we want to create a transaction sending coins from <code>bdk-test</code> wallet to the <code>core</code> wallet.</p> <ul><li><p>fetch a new <code>core</code> address</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token assign-left variable">core_addrs</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>docker <span class="token builtin class-name">exec</span> -it bdk-box /root/bitcoin-cli -regtest getnewaddress <span class="token operator">|</span> <span class="token function">tr</span> -d <span class="token string">'\r'</span><span class="token variable">)</span></span>
</code></pre></div></li> <li><p>Create a raw transaction using <code>bdk-cli</code> to the above address. This will generate a <code>psbt</code> which we will sign.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token assign-left variable">psbt</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>bdk-cli --network regtest wallet --node <span class="token string">&quot;127.0.0.1:18444&quot;</span> --wallet bdk-test -d $BDK_recv_desc -c $BDK_chng_desc create_tx --to $core_addrs:200000000 <span class="token operator">|</span> jq -r <span class="token string">'.psbt'</span><span class="token variable">)</span></span>
</code></pre></div><p>(Recommended to check all the other information returned by <code>bdk-cli create_tx</code>)</p></li></ul> <h3 id="sign-and-broadcast-the-transaction"><a href="#sign-and-broadcast-the-transaction" class="header-anchor">#</a> Sign and Broadcast the transaction</h3> <p>Asking BDK to sign a transaction is as straight forward as it can get. BDK already holds the <code>xprv</code> deatils to sign a transaction. It returns a finalised <code>signed_psbt</code> which we will next broadcast to the network.</p> <ul><li><p>Sign the transaction</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token assign-left variable">signed_psbt</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>bdk-cli --network regtest wallet --node <span class="token string">&quot;127.0.0.1:18444&quot;</span> --wallet bdk-test -d $BDK_recv_desc -c $BDK_chng_desc sign --psbt $psbt <span class="token operator">|</span> jq -r <span class="token string">'.psbt'</span><span class="token variable">)</span></span>
</code></pre></div></li> <li><p>Broadcast the transaction</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ bdk-cli --network regtest wallet --node <span class="token string">&quot;127.0.0.1:18444&quot;</span> --wallet bdk-test -d <span class="token variable">$BDK_recv_desc</span> -c <span class="token variable">$BDK_chng_desc</span> broadcast --psbt <span class="token variable">$signed_psbt</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;txid&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;c343f5b25372e285308eba912d1fe8fade9f64afde6d95306e248e52e0852252&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This makes BDK broadcast the transaction via the connected core node, and it returns the corresponding Txid.</p></li></ul> <h3 id="confirming-the-transaction"><a href="#confirming-the-transaction" class="header-anchor">#</a> Confirming the Transaction</h3> <p>The transaction has been received by the <code>core</code> node and waiting in its mempool for inclusion in block.
We can see the transaction via its <code>txid</code> received in previous step.</p> <ul><li><p>Check transaction in mempool</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ docker <span class="token builtin class-name">exec</span> -it bdk-box /root/bitcoin-cli -regtest gettransaction c343f5b25372e285308eba912d1fe8fade9f64afde6d95306e2248e52e0852252
<span class="token punctuation">{</span>
  <span class="token string">&quot;amount&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2.00000000</span>,
  <span class="token string">&quot;confirmations&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;trusted&quot;</span><span class="token builtin class-name">:</span> false,
  <span class="token string">&quot;txid&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;c343f5b25372e285308eba912d1fe8fade9f64afde6d95306e248e52e0852252&quot;</span>,
  <span class="token string">&quot;walletconflicts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">]</span>,
  <span class="token string">&quot;time&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1621697202</span>,
  <span class="token string">&quot;timereceived&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1621697202</span>,
  <span class="token string">&quot;bip125-replaceable&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;no&quot;</span>,
  <span class="token string">&quot;details&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bcrt1q3h4hs6mve5dcl7da3d4acmlp20hh8c3t4mldwe&quot;</span>,
      <span class="token string">&quot;category&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;receive&quot;</span>,
      <span class="token string">&quot;amount&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2.00000000</span>,
      <span class="token string">&quot;label&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
      <span class="token string">&quot;vout&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>,
  <span class="token string">&quot;hex&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;01000000000101d84e8cb7477f9fe6f265b56d5416ff47da9a70be18f65ec50731b8257c67f2bd0100000000ffffffff0273a2e11100000000160014874270187001febc4cebd8cb083cf2c783e8f1ac00c2eb0b000000001600148deb786b6ccd1b8ff9bd8b6bdc6fe153ef73e22b0247304402201037d9ef5b80392296311c8899b1f12a0987778d694a442a88bafa6fbd7a7c9a022011293176255897444d9c71b0b9cd13b2aedb749b142577566c90a63d61025e2c01210202427d16b29c1c8546255363a74326ee9ab3196770bb3fccc7b679d52f9c1ccf00000000&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This means, core has recieved the transaction in its mempool and waiting for confirmation.</p></li> <li><p>Generate 1 block to confirm the transaction</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ docker <span class="token builtin class-name">exec</span> -it bdk-box /root/bitcoin-cli -regtest generatetoaddress <span class="token number">1</span> bcrt1qatd7yq0jukwusuaufltlejmeydpvnpv43r5gc2
<span class="token punctuation">[</span>
  <span class="token string">&quot;55436ff0169bbb3e70ab10cb7cdd45ab86204d5d7864a109142d91120d023197&quot;</span>
<span class="token punctuation">]</span>
</code></pre></div></li> <li><p>Sync the <code>bdk-test</code> wallet and ask for available balance.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>  $ bdk-cli --network regtest wallet --node <span class="token string">&quot;127.0.0.1:18444&quot;</span> --wallet bdk-test -d <span class="token variable">$BDK_recv_desc</span> -c <span class="token variable">$BDK_chng_desc</span> <span class="token function">sync</span>
  <span class="token punctuation">{</span><span class="token punctuation">}</span>

  $ bdk-cli --network regtest wallet --node <span class="token string">&quot;127.0.0.1:18444&quot;</span> --wallet bdk-test -d <span class="token variable">$BDK_recv_desc</span> -c <span class="token variable">$BDK_chng_desc</span> get_balance
  <span class="token punctuation">{</span>
  	<span class="token string">&quot;satoshi&quot;</span><span class="token builtin class-name">:</span> <span class="token number">299999859</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>If you see the balance updated, voila!</p> <p>What happened here is:</p> <ul><li>core created a new block containing the transaction.</li> <li><code>bdk-cli</code> fetched the corresponding filter data.</li> <li>It noticed it got a concerning transaction.</li> <li>It asked for the details of that transaction from the core node.</li> <li>It updated its wallet details with this new information.</li> <li>The update is reflected in the wallet balance.</li></ul></li></ul> <h3 id="shutdown-docker"><a href="#shutdown-docker" class="header-anchor">#</a> Shutdown Docker</h3> <p>You may now shutdown the regtest docker container.</p> <p>Note: This will also clean up any data in the bitcoin core, including the wallet.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ docker <span class="token function">kill</span> bdk-box
</code></pre></div><h2 id="end-words"><a href="#end-words" class="header-anchor">#</a> End Words</h2> <p>In this tutorial we went through the process of receiving, creating, signing and broadcasting transaction using the BDK wallet with <code>compact_filters</code> feature. This demonstrates how BDK capabilities can be used to create SPV light wallets with integrated <code>BIP157</code> type <code>compact_filters</code> node.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/bitcoindevkit/bitcoindevkit.org/edit/master/docs/_blog/compact_filters_demo.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/28/2022, 8:28:24 AM</span></div></footer> <!----> </main></div></div> <footer class="footer" data-v-9ca807bc><div class="wrap"><div class="wrap-border"><div class="inner"><div class="footer-content"><div class="footer-block"><h4>Docs</h4> <div><a href="/getting-started/" class="nav-link">
  Getting Started
</a></div><div><a href="/bdk-cli/installation/" class="nav-link">
  BDK-CLI
</a></div><div><a href="/descriptors/" class="nav-link">
  Descriptors
</a></div></div><div class="footer-block"><h4>Community</h4> <div><a href="https://github.com/bitcoindevkit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div><a href="https://twitter.com/intent/follow?screen_name=bitcoindevkit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div><a href="https://discord.gg/dstn4dQ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat on Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></div><div class="footer-block"><h4>More</h4> <div><a href="/blog/" class="nav-link router-link-active">
  Blog
</a></div><div><a href="/supporters/" class="nav-link">
  Supporters
</a></div></div></div> <p class="copyright">Copyright  2022 BDK Developers</p></div></div></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5d09363a.js" defer></script><script src="/assets/js/8.cbf41989.js" defer></script><script src="/assets/js/1.e424882b.js" defer></script><script src="/assets/js/17.3efb05a1.js" defer></script>
  </body>
</html>
