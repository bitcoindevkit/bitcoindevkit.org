

<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.79.0" />
    <meta name="description" content="The Bitcoin Dev Kit project aims to build a collection of tools and libraries that are designed to be a solid foundation for Bitcoin wallets.">
<meta name="author" content="Alekos Filini - @afilini">

    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
<link rel="manifest" href="/icons/site.webmanifest">
<link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

    <title>Compiler :: Bitcoin Dev Kit</title>

    
    <link href="/css/nucleus.css?1608285117" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1608285117" rel="stylesheet">
    <link href="/css/hybrid.css?1608285117" rel="stylesheet">
    <link href="/css/featherlight.min.css?1608285117" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1608285117" rel="stylesheet">
    <link href="/css/auto-complete.css?1608285117" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1608285117" rel="stylesheet">
    <link href="/css/theme.css?1608285117" rel="stylesheet">
    <link href="/css/hugo-theme.css?1608285117" rel="stylesheet">
    
    <link href="/css/theme-blue.css?1608285117" rel="stylesheet">
    
    <link href="/css/style.css?1608285117" rel="stylesheet"><link href="/css/jsonview.css?1608285117" rel="stylesheet"><link href="/css/blog.css?1608285117" rel="stylesheet">

    <meta property="og:title" content="Compiler" />
<meta property="og:description" content="Introduction If you want to play around with more complicated spending policies, you&rsquo;ll start to find it harder and harder to manually create the descriptors. This is where the miniscript compiler comes in! The bdk library includes a very simple compiler that can produce a descriptor given a spending policy. The syntax used to encode the spending policy is very well described in this page, specifically in the &ldquo;Policy to Miniscript compiler&rdquo;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bitcoindevkit.org/repl/compiler/" />
<meta property="og:image" content="https://bitcoindevkit.org/images/logo-wide.jpg"/>
<meta property="article:published_time" content="2020-04-29T12:06:50+02:00" />
<meta property="article:modified_time" content="2020-04-29T12:06:50+02:00" />

    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://bitcoindevkit.org/images/logo-wide.jpg"/>

<meta name="twitter:title" content="Compiler"/>
<meta name="twitter:description" content="Introduction If you want to play around with more complicated spending policies, you&rsquo;ll start to find it harder and harder to manually create the descriptors. This is where the miniscript compiler comes in! The bdk library includes a very simple compiler that can produce a descriptor given a spending policy. The syntax used to encode the spending policy is very well described in this page, specifically in the &ldquo;Policy to Miniscript compiler&rdquo;."/>


    <script src="/js/jquery-3.3.1.min.js?1608285117"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/repl/compiler/">
    


<nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">
    <img src="/images/logo.svg" alt="Bitcoin Dev Kit logo"/>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1608285117"></script>
<script type="text/javascript" src="/js/auto-complete.js?1608285117"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/bitcoindevkit.org\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1608285117"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/blog/" title="Blog" class="dd-item
        
        
        
        ">
      <a href="/blog/">
          <i class="fas fa-newspaper"></i> Blog
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/repl/" title="REPL" class="dd-item
        parent
        
        
        ">
      <a href="/repl/">
          <i class="fas fa-terminal"></i> REPL
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/repl/installation/" title="Installation" class="dd-item ">
        <a href="/repl/installation/">
        <b>1. </b>Installation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/repl/concept/" title="Concept" class="dd-item ">
        <a href="/repl/concept/">
        <b>2. </b>Concept
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/repl/interface/" title="Interface" class="dd-item ">
        <a href="/repl/interface/">
        <b>3. </b>Interface
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/repl/regtest/" title="Regtest" class="dd-item ">
        <a href="/repl/regtest/">
        <b>4. </b>Regtest
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/repl/compiler/" title="Compiler" class="dd-item active">
        <a href="/repl/compiler/">
        <b>5. </b>Compiler
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/repl/playground/" title="Playground" class="dd-item ">
        <a href="/repl/playground/">
        <b>6. </b>Playground
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/descriptors/" title="Descriptors" class="dd-item
        
        
        
        ">
      <a href="/descriptors/">
          <i class="fas fa-code"></i> Descriptors
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/supporters/" title="Supporters" class="dd-item
        
        
        
        ">
      <a href="/supporters/">
          <i class="fas fa-heart"></i> Supporters
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://bitcoindevkit.org/docs-rs/bdk/"><i class='fas fa-book-open'></i> Rust Docs</a>
              </li>
          
              <li>
                  <a class="padding" href="https://bitcoindevkit.org/repl/playground"><i class='fas fa-magic'></i> Playground</a>
              </li>
          
              <li>
                  <a class="padding" href="https://twitter.com/intent/follow?screen_name=bitcoindevkit"><i style='font-size: 20px' class='fab fa-twitter-square'></i> Follow on Twitter</a>
              </li>
          
              <li>
                  <a class="padding" href="https://discord.gg/dstn4dQ"><i style='font-size: 20px' class='fab fa-discord'></i> Chat on Discord</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <script type="text/javascript" src="/js/github-buttons.js"></script>

<center>
    
    <a class="github-button" href="https://github.com/bitcoindevkit/bdk/subscription" data-icon="octicon-eye" data-show-count="true" aria-label="Watch bitcoindevkit/bdk on GitHub">Watch</a>
    <a class="github-button" href="https://github.com/bitcoindevkit/bdk" data-icon="octicon-star" data-show-count="true" aria-label="Star bitcoindevkit/bdk on GitHub">Star</a>
    <a class="github-button" href="https://github.com/bitcoindevkit/bdk/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork bitcoindevkit/bdk on GitHub">Fork</a>
</center>

<center>Built with <a href="https://gohugo.io/">Hugo</a></center>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/bitcoindevkit/bitcoindevkit.org/edit/master/content/repl/compiler.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                   Compiler
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#installation">Installation</a></li>
    <li><a href="#usage">Usage</a></li>
    <li><a href="#example">Example</a></li>
    <li><a href="#troubleshooting">Troubleshooting</a>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        



        </div>
        
        <div id="body-inner">
          
            
            <h1>
              
              Compiler
            </h1>
            
          

        


<h2 id="introduction">Introduction</h2>
<p>If you want to play around with more complicated spending policies, you&rsquo;ll start to find it harder and harder to manually create the descriptors. This is where the miniscript compiler comes in! The <code>bdk</code> library
includes a very simple compiler that can produce a descriptor given a spending policy. The syntax used to encode the spending policy is very well described <a href="http://bitcoin.sipa.be/miniscript/">in this page</a>,
specifically in the &ldquo;Policy to Miniscript compiler&rdquo;. The compiler included in BDK does basically the same job, but produces descriptors for <code>rust-miniscript</code> that have some minor differences from
the ones made by the C++ implementation used in that website.</p>
<h2 id="installation">Installation</h2>
<p>To install the miniscript compiler run the following command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cargo install --git https://github.com/bitcoindevkit/bdk --features<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;compiler&#34;</span> --example miniscriptc
</code></pre></div><p>Once the command is done, you should have a <code>miniscriptc</code> command available. You can check if that&rsquo;s the case by running <code>miniscriptc --help</code>.</p>
<h2 id="usage">Usage</h2>
<p>In this case the interface is very simple: it accepts two arguments called &ldquo;POLICY&rdquo; and &ldquo;TYPE&rdquo;, in this order. The first one, as the name implies, sets the spending policy to compile. The latter defines the type
of address that should be used to encapsulate the produced script, like a P2SH, P2WSH, etc.</p>
<p>Optionally, the <code>--parsed_policy</code> flag can be enabled and it will make the compiler print the JSON &ldquo;human-readable&rdquo; version of the spending policy, as described in the <a href="/repl/interface/#policies"><code>policies subcommand</code></a> of the CLI.</p>
<p>The <code>--network</code> flag can be used to change the network encoding of the address shown.</p>

<div class="notices tip" ><p>Keep in mind that since the compiler loads and interprets the descriptor, all the public keys specified in the policy must be valid public keys. This differs from the web tool linked above that also accepts
placeholders too. As described in the previous sections of this guide, the keys can be either <code>xpub</code>/<code>xprv</code> with or without metadata and a derivation path, WIF keys or raw hex public keys.</p>
</div>

<h2 id="example">Example</h2>
<p>Let&rsquo;s take this policy for example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">miniscriptc --parsed_policy and<span style="color:#f92672">(</span>pk<span style="color:#f92672">(</span>cSQPHDBwXGjVzWRqAHm6zfvQhaTuj1f2bFH58h55ghbjtFwvmeXR<span style="color:#f92672">)</span>,or<span style="color:#f92672">(</span>50@pk<span style="color:#f92672">(</span>02e96fe52ef0e22d2f131dd425ce1893073a3c6ad20e8cac36726393dfb4856a4c<span style="color:#f92672">)</span>,older<span style="color:#f92672">(</span>1000<span style="color:#f92672">))))</span> sh-wsh
</code></pre></div><p>The compiler should print something like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">[2020-04-29T10:42:05Z INFO  miniscriptc] Compiling policy: and(pk(cSQPHDBwXGjVzWRqAHm6zfvQhaTuj1f2bFH58h55ghbjtFwvmeXR),or(50@pk(02e96fe52ef0e22d2f131dd425ce1893073a3c6ad20e8cac36726393dfb4856a4c),older(1000)))
[2020-04-29T10:42:05Z INFO  miniscriptc] ... Descriptor: sh(wsh(and_v(or_c(c:pk(02e96fe52ef0e22d2f131dd425ce1893073a3c6ad20e8cac36726393dfb4856a4c),v:older(1000)),c:pk(cSQPHDBwXGjVzWRqAHm6zfvQhaTuj1f2bFH58h55ghbjtFwvmeXR))))
[2020-04-29T10:42:05Z INFO  miniscriptc] ... First address: 2MsqrJuZewY3o3ADAy1Uhi5vsBqTANjH3Cf
</code></pre></div><p>JSON policy:</p>

<div class="json" data-json='{
&ldquo;type&rdquo;:&ldquo;THRESH&rdquo;,
&ldquo;items&rdquo;:[
{
&ldquo;type&rdquo;:&ldquo;THRESH&rdquo;,
&ldquo;items&rdquo;:[
{
&ldquo;type&rdquo;:&ldquo;SIGNATURE&rdquo;,
&ldquo;pubkey&rdquo;:&ldquo;02e96fe52ef0e22d2f131dd425ce1893073a3c6ad20e8cac36726393dfb4856a4c&rdquo;,
&ldquo;satisfaction&rdquo;:{
&ldquo;type&rdquo;:&ldquo;NONE&rdquo;
},
&ldquo;contribution&rdquo;:{
&ldquo;type&rdquo;:&ldquo;NONE&rdquo;
}
},
{
&ldquo;type&rdquo;:&ldquo;RELATIVETIMELOCK&rdquo;,
&ldquo;value&rdquo;:1000,
&ldquo;satisfaction&rdquo;:{
&ldquo;type&rdquo;:&ldquo;NONE&rdquo;
},
&ldquo;contribution&rdquo;:{
&ldquo;type&rdquo;:&ldquo;COMPLETE&rdquo;,
&ldquo;condition&rdquo;:{
&ldquo;csv&rdquo;:1000
}
}
}
],
&ldquo;threshold&rdquo;:1,
&ldquo;satisfaction&rdquo;:{
&ldquo;type&rdquo;:&ldquo;NONE&rdquo;
},
&ldquo;contribution&rdquo;:{
&ldquo;type&rdquo;:&ldquo;PARTIALCOMPLETE&rdquo;,
&ldquo;n&rdquo;:2,
&ldquo;m&rdquo;:1,
&ldquo;items&rdquo;:[
1
],
&ldquo;conditions&rdquo;:{
&ldquo;[1]&quot;:[
{
&ldquo;csv&rdquo;:1000
}
]
}
}
},
{
&ldquo;type&rdquo;:&ldquo;SIGNATURE&rdquo;,
&ldquo;pubkey&rdquo;:&ldquo;02e96fe52ef0e22d2f131dd425ce1893073a3c6ad20e8cac36726393dfb4856a4c&rdquo;,
&ldquo;satisfaction&rdquo;:{
&ldquo;type&rdquo;:&ldquo;NONE&rdquo;
},
&ldquo;contribution&rdquo;:{
&ldquo;type&rdquo;:&ldquo;COMPLETE&rdquo;,
&ldquo;condition&rdquo;:{
    }
  }
}

],
&ldquo;threshold&rdquo;:2,
&ldquo;satisfaction&rdquo;:{
&ldquo;type&rdquo;:&ldquo;NONE&rdquo;
},
&ldquo;contribution&rdquo;:{
&ldquo;type&rdquo;:&ldquo;PARTIALCOMPLETE&rdquo;,
&ldquo;n&rdquo;:2,
&ldquo;m&rdquo;:2,
&ldquo;items&rdquo;:[
0,
1
],
&ldquo;conditions&rdquo;:{
&ldquo;[0, 1]&quot;:[
{
&ldquo;csv&rdquo;:1000
}
]
}
}
}
'></div>

<h2 id="troubleshooting">Troubleshooting</h2>
<h4 id="nothing-is-printed">Nothing is printed</h4>
<p>This might mean that you have a <code>RUST_LOG</code> variable set to a value that suppresses the compiler&rsquo;s log. You can try adding <code>miniscriptc=info</code> to your <code>RUST_LOG</code> value and see if that works, or open a new clean
shell.</p>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1608285117"></script>
    <script src="/js/perfect-scrollbar.min.js?1608285117"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1608285117"></script>
    <script src="/js/jquery.sticky.js?1608285117"></script>
    <script src="/js/featherlight.min.js?1608285117"></script>
    <script src="/js/highlight.pack.js?1608285117"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1608285117"></script>
    <script src="/js/learn.js?1608285117"></script>
    <script src="/js/hugo-learn.js?1608285117"></script>
    
        
            <script src="/mermaid/mermaid.js?1608285117"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    <script type="text/javascript" src="/js/jsonview.js" charset="utf-8"></script>
<script type="text/javascript" src="/js/main.js" charset="utf-8"></script>

  </body>
</html>

